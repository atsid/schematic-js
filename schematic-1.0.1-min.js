define("schematic/Logger",[],function(){return function(e,t,n){var r={TRACE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5},i,s=[];e=r[e.toUpperCase()],t||(t=console),typeof n=="undefined"&&(n=""),i=function(e,r,i,o,u){var a=t[e]||t.info;r=n+r;if(o)i?a.call(t,r+" --> "+JSON.stringify(i)):a.call(t,r);else try{u[0]&&(u[0]=n+u[0]),a.apply(t,u)}catch(f){a(r,i,o,u)}s.forEach(function(t){t.log(e,r,i,o)})},this.addPlugin=function(e){s.push(e)},this.trace=function(t,n,s){e<=r.TRACE&&i("debug",t,n,s,arguments)},this.debug=function(t,n,s){e<=r.DEBUG&&i("debug",t,n,s,arguments)},this.info=function(t,n,s){e<=r.INFO&&i("info",t,n,s,arguments)},this.warn=function(t,n,s){e<=r.WARN&&i("warn",t,n,s,arguments)},this.error=function(t,n,s){e<=r.ERROR&&i("error",t,n,s,arguments)},this.time=function(e){t.time.apply(t,arguments)},this.timeEnd=function(e){t.timeEnd.apply(t,arguments)}}}),define("schematic/log",["./Logger"],function(e){return new e("debug")}),define("schematic/SchemaResolver",[],function(){return function(e){this.resolveRefs=function(t,n,r){(!t.tag||!t.tag.resolved)&&Object.keys(t).forEach(function(i,s,o){var u=t[i],a;i==="$ref"?(e.some(function(e){return a=e(u),a}),a&&!a.resolved&&(a.resolved=!0,this.resolveRefs(a,t,i)),n[r]=a):typeof u=="object"&&!u.resolved&&this.resolveRefs(u,t,i)},this)}}}),define("schematic/Validator",[],function(){return function(e,t,n){return}}),define("schematic/BackboneExtension",["./Validator","./log"],function(e,t){var n,r;return typeof Backbone!="undefined"&&(r=Backbone.sync,Backbone.sync=function(e,n,i){if(!(n instanceof Backbone.SchematicModel))return r(e,n,i);t.debug(e+" : "+n+" : "+i)},Backbone.SchematicModel=Backbone.Model.extend({initialize:function(e,t){var n=this,r=this.jsonschema=t&&t.schema;Object.keys(r&&r.properties).forEach(function(e,t,r){Object.defineProperty(n,e,{get:function(){return n.get(e)},set:function(t){return n.set(e,t,{validate:!0})},enumerable:!0})})},validate:function(t,n){var r=new Backbone.Model(this.toJSON());return r.set(t),e(this.jsonschema,r.toJSON(),t)}}),n=Backbone.SchematicModel),n}),define("schematic/ModelFactory",["./log","./SchemaResolver","./BackboneExtension"],function(e,t,n){return function(r){var i=this,s=[],o=function(e){var t=[];return s.forEach(function(n){n.modelPattern.test(e)&&t.push(n)}),t},u=function(t,n,r,s){var o=n,u=n||{},a=this,f,l=s&&s.createSubModels,c={},h={},p=function(n,r){var i=!1;if(c[n])e.debug("schema: "+t.id+" contains property: "+n),i=!0;else{e.debug("schema: "+t.id+" does not contain property: "+n);if(!r)throw new Error(n+" not defined in  "+t.id)}return i},d=function(n,i,s){var o=c[n],u,l=!0;return e.debug("Checking if property: "+n+" is valid to set"),p(n,s)&&(l=r.some(function(e,r,s){if(e.propertyPattern.test(n))return u=e.validate(n,a,i,t),u}),f=u),!l},v=function(e,t){Object.keys(e.properties).forEach(function(n){t[n]=e.properties[n]})},m=function(e,t){e["extends"]&&m(e["extends"],t),t(e)};return m(t,function(e){v(e,c)}),Object.defineProperty(a,"schemaId",{get:function(){return t.id},enumerable:!0}),Object.defineProperty(a,"lastErrors",{get:function(){return f},enumerable:!1}),this.validate=function(e,t){var n,r=d(e,t,!0);return r||(n=f),n},this.get=function(e){var t,n=c[e];if(p(e))return n.type==="array"&&o?(t=[],u[e].forEach(function(e,r){e&&t.push(i.getModel(n.items,e))},this)):u[e]&&(t=o&&n.type==="object"?i.getModel(n,u[e]):u[e]),t},this.set=function(e,t){if(d(e,t))return h[e]&&h[e].forEach(function(n,r,i){n(u[e],t)}),u[e]=t,!0},this.onChange=function(e,t){h[e]||(h[e]=[]),h[e].push(t)},this.getRaw=function(){return u},this.initialize=function(t){Object.keys(t).forEach(function(n,r,s){var o;t[n]&&(t[n].schemaId?(e.debug("Getting and initializing model with schema ID: "+t[n].schemaId),o=i.getModel(t[n].schemaId),o.initialize(t[n]),a.set(n,o)):d(n,t[n],!0)&&a.set(n,JSON.parse(JSON.stringify(t[n]))))})},Object.keys(c).forEach(function(e,t,n){Object.defineProperty(a,e,{get:function(){return a.get(e)},set:function(t){return a.set(e,t)},enumerable:!0}),c[e].id&&l&&a.set(e,i.getModel(c[e].id))}),Object.freeze(this)};this.config=r||{resolver:function(e){var t;return require([e],function(e){e&&(typeof e=="function"?t=new e:t=e)}),t}},this.resolvers=[this.config.resolver],this.addResolver=function(e){this.resolvers.push(e)},this.getModelBySchema=function(t,r,i){var s;return e.debug("Getting new model with schema ID: "+t.id),typeof n=="function"?s=new n(r,{validate:!0,schema:t,serviceFactory:this.config.serviceFactory}):s=new u(t,r,o(t.id),i),s},this.getModel=function(e,t,n){var r;return typeof e=="string"?r=this.getModelByName(e,t,n):r=this.getModelBySchema(e,t,n),r},this.getSchema=function(e){var n,r=new t(this.resolvers);return this.resolvers.some(function(t){return n=t(e),n}),r.resolveRefs(n,null,null),n},this.addValidator=function(e){s.push(e)},this.getModelByName=function(t,n,r){var i=this.getSchema(t);return e.debug("Getting new model by name: "+t+" using schema: "+i),this.getModelBySchema(i,n,r)},this.getModelInitialized=function(t,n){var r;return t.schemaId?r=this.getModel(t.schemaId):r=this.getModel(n),e.debug("Initializing new model with schema ID: "+r.schemaId),r.initialize(t),r}}}),define("schematic/util",{mixin:function(e,t){var n;for(n in t)e[n]=t[n];return e}}),define("schematic/plugins/FutureDateValidationPlugin",["../util"],function(e){var t=function(t){this.message={code:0,message:"Date is not in the future"},e.mixin(this,t),this.validate=function(e,t,n,r){var i=[],s=n||t[e],o=Date.parse(s),u=Date.now();return u>=o&&i.push(this.message),i.length?i:undefined}};return t}),define("schematic/plugins/LuhnValidationPlugin",["../util"],function(e){var t=function(t){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}this.message={code:0,message:"Invalid number"},e.mixin(this,t),this.validate=function(e,t,r,i){var s=[],o=r||t[e],u=0,a=o&&o.length,f=a%2,l,c;if(o&&n(o)){for(l=0;l<a;l+=1)c=parseInt(o.charAt(l),10),l%2===f&&(c*=2),c>9&&(c-=9),u+=c;u%10!==0&&s.push(this.message)}else s.push(this.message);return s.length?s:undefined}};return t}),define("schematic/plugins/RegExpValidationPlugin",["../util"],function(e){var t=function(t){var n=this;this.message={code:0,message:"Failed regular expression match"},e.mixin(this,t),this.validate=function(e,t,r,i){var s=[],o=r||t[e],u=new RegExp(this.pattern||".*");return u.test(o)||s.push(n.message),s.length?s:undefined}};return t}),define("schematic/plugins/SchemaValidationPlugin",["../util"],function(e){var t=function(e,n){var r=e&&e.properties&&e.properties[n];return!r&&e["extends"]&&(r=t(e["extends"],n)),r},n=function(n){this.requiredMessage={code:0,message:"Field is required."},e.mixin(this,n),this.validate=function(e,n,r,i){var s=[],o=r===undefined?n[e]:r,u=t(i,e);return u&&u.required&&!o&&s.push(this.requiredMessage),s.length?s:undefined}};return n}),define("schematic/fullpack",["./ModelFactory","./plugins/FutureDateValidationPlugin","./plugins/LuhnValidationPlugin","./plugins/RegExpValidationPlugin","./plugins/SchemaValidationPlugin"],function(){});